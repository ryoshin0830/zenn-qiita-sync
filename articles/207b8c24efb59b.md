---
title: devcontainerã§é–‹ç™ºç’°å¢ƒã‚’é©æ–°ã™ã‚‹ - åˆå¿ƒè€…ã‹ã‚‰ä¸Šç´šè€…ã¾ã§å®Œå…¨ã‚¬ã‚¤ãƒ‰
emoji: "\U0001F433"
type: tech
topics:
  - Docker
  - VSCode
  - é–‹ç™ºç’°å¢ƒ
  - DevContainer
  - ã‚³ãƒ³ãƒ†ãƒŠ
published: true
---
# ã¯ã˜ã‚ã«

ã€Œæ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å‚åŠ ã—ãŸã‘ã©ã€é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã«ä¸¸ä¸€æ—¥ã‹ã‹ã£ã¦ã—ã¾ã£ãŸ...ã€
ã€Œãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãã‚Œãã‚Œã®ç’°å¢ƒã§å¾®å¦™ã«å‹•ä½œãŒé•ã£ã¦ã€ãƒ‡ãƒãƒƒã‚°ã«æ™‚é–“ã‚’å–ã‚‰ã‚Œã‚‹...ã€

ã“ã‚“ãªçµŒé¨“ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

**devcontainer**ã¯ã€ã“ã‚Œã‚‰ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€devcontainerã®åŸºæœ¬ã‹ã‚‰å¿œç”¨ã¾ã§ã€å®Ÿè·µçš„ãªä¾‹ã‚’äº¤ãˆãªãŒã‚‰è§£èª¬ã—ã¾ã™ã€‚

# devcontainerã¨ã¯ï¼Ÿ

devcontainerï¼ˆDevelopment Containerï¼‰ã¯ã€**é–‹ç™ºç’°å¢ƒå…¨ä½“ã‚’ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã™ã‚‹ä»•çµ„ã¿**ã§ã™ã€‚Visual Studio Codeï¼ˆVSCodeï¼‰ã¨çµ±åˆã•ã‚Œã¦ãŠã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ç‹¬ç«‹ã—ãŸé–‹ç™ºç’°å¢ƒã‚’ç°¡å˜ã«æ§‹ç¯‰ãƒ»å…±æœ‰ã§ãã¾ã™ã€‚

## å¾“æ¥ã®é–‹ç™ºç’°å¢ƒã®èª²é¡Œ

1. **ç’°å¢ƒæ§‹ç¯‰ã®è¤‡é›‘ã•**: è¨€èªã€ãƒ„ãƒ¼ãƒ«ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š
2. **ç’°å¢ƒã®ä¸ä¸€è‡´**: ã€Œç§ã®ç’°å¢ƒã§ã¯å‹•ãã®ã«...ã€å•é¡Œ
3. **ç’°å¢ƒã®æ±šæŸ“**: è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜é–¢ä¿‚ãŒç«¶åˆ
4. **ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®æ™‚é–“**: æ–°ãƒ¡ãƒ³ãƒãƒ¼ã®ç’°å¢ƒæ§‹ç¯‰ã«æ™‚é–“ãŒã‹ã‹ã‚‹

## devcontainerãŒè§£æ±ºã™ã‚‹ã“ã¨

```mermaid
graph LR
    A[é–‹ç™ºè€…A] --> D[åŒã˜é–‹ç™ºç’°å¢ƒ]
    B[é–‹ç™ºè€…B] --> D
    C[é–‹ç™ºè€…C] --> D
    D --> E[ä¸€è²«ã—ãŸå‹•ä½œ]
```

- **å†ç¾æ€§**: èª°ã§ã‚‚åŒã˜ç’°å¢ƒã‚’ç¬æ™‚ã«æ§‹ç¯‰
- **ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£**: ã©ã®ãƒã‚·ãƒ³ã§ã‚‚åŒã˜ç’°å¢ƒ
- **éš”é›¢æ€§**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«ç‹¬ç«‹ã—ãŸç’°å¢ƒ
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: ç’°å¢ƒè¨­å®šã‚‚Gitã§ç®¡ç†

# åŸºæœ¬çš„ãªä½¿ã„æ–¹

## å¿…è¦ãªã‚‚ã®

1. **Docker Desktop**ï¼ˆã¾ãŸã¯Docker Engineï¼‰
2. **Visual Studio Code**
3. **Dev Containersæ‹¡å¼µæ©Ÿèƒ½**

```bash
# Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
docker --version

# VSCodeã®æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
code --install-extension ms-vscode-remote.remote-containers
```

## æœ€å°æ§‹æˆã®devcontainer

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆã« `.devcontainer` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€`devcontainer.json` ã‚’é…ç½®ã—ã¾ã™ã€‚

```json
{
  "name": "My Project",
  "image": "mcr.microsoft.com/devcontainers/base:ubuntu",
  "features": {
    "ghcr.io/devcontainers/features/git:1": {}
  }
}
```

ã“ã‚Œã ã‘ã§ã€Ubuntuãƒ™ãƒ¼ã‚¹ã®é–‹ç™ºç’°å¢ƒãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ï¼

# å®Ÿè·µçš„ãªè¨­å®šä¾‹

## Node.jsé–‹ç™ºç’°å¢ƒ

```json
{
  "name": "Node.js Project",
  "image": "mcr.microsoft.com/devcontainers/javascript-node:18",
  "features": {
    "ghcr.io/devcontainers/features/node:1": {
      "version": "18",
      "nodeGypDependencies": true
    }
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode",
        "streetsidesoftware.code-spell-checker"
      ],
      "settings": {
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "esbenp.prettier-vscode"
      }
    }
  },
  "forwardPorts": [3000],
  "postCreateCommand": "npm install",
  "remoteUser": "node"
}
```

## Pythonæ©Ÿæ¢°å­¦ç¿’ç’°å¢ƒ

```json
{
  "name": "Python ML Project",
  "build": {
    "dockerfile": "Dockerfile",
    "context": ".."
  },
  "features": {
    "ghcr.io/devcontainers/features/python:1": {
      "version": "3.11"
    },
    "ghcr.io/devcontainers/features/jupyterlab:1": {}
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-python.vscode-pylance",
        "ms-toolsai.jupyter"
      ]
    }
  },
  "postCreateCommand": "pip install -r requirements.txt",
  "mounts": [
    "source=${localEnv:HOME}/.ssh,target=/home/vscode/.ssh,type=bind,consistency=cached"
  ]
}
```

å¯¾å¿œã™ã‚‹Dockerfile:

```dockerfile
FROM mcr.microsoft.com/devcontainers/python:3.11

# GPUã‚µãƒãƒ¼ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
RUN apt-get update && apt-get install -y \
    libgl1-mesa-glx \
    libglib2.0-0 \
    && rm -rf /var/lib/apt/lists/*

# è¿½åŠ ã®Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
COPY requirements.txt /tmp/
RUN pip install --upgrade pip && \
    pip install -r /tmp/requirements.txt
```

# é«˜åº¦ãªæ©Ÿèƒ½

## 1. Docker Composeã¨ã®é€£æº

è¤‡æ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ„ã¿åˆã‚ã›ãŸé–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

`.devcontainer/docker-compose.yml`:

```yaml
version: '3.8'

services:
  app:
    build:
      context: ..
      dockerfile: .devcontainer/Dockerfile
    volumes:
      - ..:/workspace:cached
    command: sleep infinity
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/myapp
    depends_on:
      - db
      - redis

  db:
    image: postgres:15
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
      POSTGRES_DB: myapp
    volumes:
      - postgres-data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine

volumes:
  postgres-data:
```

`.devcontainer/devcontainer.json`:

```json
{
  "name": "Full Stack App",
  "dockerComposeFile": "docker-compose.yml",
  "service": "app",
  "workspaceFolder": "/workspace",
  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2": {}
  },
  "forwardPorts": [3000, 5432, 6379],
  "postCreateCommand": "npm install && npm run db:migrate"
}
```

## 2. é–‹ç™ºç’°å¢ƒã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯

```json
{
  "initializeCommand": "echo 'é–‹ç™ºç’°å¢ƒã‚’åˆæœŸåŒ–ä¸­...'",
  "onCreateCommand": "bash .devcontainer/setup.sh",
  "updateContentCommand": "npm install",
  "postCreateCommand": "npm run prepare",
  "postStartCommand": "git config --global user.email 'dev@example.com'",
  "postAttachCommand": "echo 'VSCodeã«ã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¾ã—ãŸï¼'"
}
```

å„ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°:

- **initializeCommand**: ã‚³ãƒ³ãƒ†ãƒŠä½œæˆå‰ï¼ˆãƒ›ã‚¹ãƒˆå´ã§å®Ÿè¡Œï¼‰
- **onCreateCommand**: ã‚³ãƒ³ãƒ†ãƒŠä½œæˆæ™‚ï¼ˆä¸€åº¦ã ã‘ï¼‰
- **updateContentCommand**: ã‚³ãƒ³ãƒ†ãƒŠä½œæˆæ™‚ã¨ãƒªãƒ“ãƒ«ãƒ‰æ™‚
- **postCreateCommand**: updateContentCommandã®å¾Œ
- **postStartCommand**: ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚
- **postAttachCommand**: VSCodeãŒã‚¢ã‚¿ãƒƒãƒã•ã‚ŒãŸæ™‚

## 3. ç’°å¢ƒå¤‰æ•°ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ

```json
{
  "containerEnv": {
    "NODE_ENV": "development",
    "API_ENDPOINT": "http://localhost:3000"
  },
  "remoteEnv": {
    "PATH": "${containerEnv:PATH}:/opt/custom/bin"
  },
  "secrets": {
    "AWS_ACCESS_KEY_ID": {
      "description": "AWS Access Key"
    },
    "AWS_SECRET_ACCESS_KEY": {
      "description": "AWS Secret Key"
    }
  }
}
```

## 4. GPUã‚µãƒãƒ¼ãƒˆ

```json
{
  "runArgs": ["--gpus", "all"],
  "containerEnv": {
    "NVIDIA_VISIBLE_DEVICES": "all",
    "NVIDIA_DRIVER_CAPABILITIES": "compute,utility"
  }
}
```

# ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

## 1. ã‚¤ãƒ¡ãƒ¼ã‚¸ã®é¸æŠ

```json
{
  // âŒ é¿ã‘ã‚‹ã¹ã: æ±ç”¨çš„ã™ãã‚‹
  "image": "ubuntu:latest",
  
  // âœ… æ¨å¥¨: é–‹ç™ºç”¨ã«æœ€é©åŒ–ã•ã‚ŒãŸã‚¤ãƒ¡ãƒ¼ã‚¸
  "image": "mcr.microsoft.com/devcontainers/base:ubuntu",
  
  // âœ… ã‚ˆã‚Šè‰¯ã„: è¨€èªç‰¹åŒ–å‹ã‚¤ãƒ¡ãƒ¼ã‚¸
  "image": "mcr.microsoft.com/devcontainers/python:3.11"
}
```

## 2. æ‹¡å¼µæ©Ÿèƒ½ã®ç®¡ç†

```json
{
  "customizations": {
    "vscode": {
      "extensions": [
        // å¿…é ˆã®æ‹¡å¼µæ©Ÿèƒ½
        "ms-python.python",
        "ms-python.vscode-pylance"
      ]
    }
  },
  // æ¨å¥¨æ‹¡å¼µæ©Ÿèƒ½ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠå¯èƒ½ï¼‰
  "recommendations": [
    "github.copilot",
    "eamodio.gitlens"
  ]
}
```

## 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–

```json
{
  "mounts": [
    // node_modulesã‚’ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆï¼ˆé«˜é€ŸåŒ–ï¼‰
    "source=node_modules,target=/workspace/node_modules,type=volume"
  ],
  "postCreateCommand": "npm install",
  // ãƒ“ãƒ«ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨
  "build": {
    "dockerfile": "Dockerfile",
    "args": {
      "BUILDKIT_INLINE_CACHE": "1"
    }
  }
}
```

## 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

```json
{
  // rootä»¥å¤–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å®Ÿè¡Œ
  "remoteUser": "vscode",
  
  // å¿…è¦æœ€å°é™ã®æ¨©é™
  "runArgs": [
    "--cap-drop=ALL",
    "--cap-add=SYS_PTRACE"
  ],
  
  // èª­ã¿å–ã‚Šå°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå¿…è¦ãªç®‡æ‰€ã®ã¿æ›¸ãè¾¼ã¿å¯èƒ½ï¼‰
  "mounts": [
    "source=/tmp,target=/tmp,type=tmpfs"
  ]
}
```

# ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

## ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

### 1. ã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ãªã„

```bash
# ãƒ­ã‚°ã‚’ç¢ºèª
docker logs <container_id>

# æ‰‹å‹•ã§ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã£ã¦ç¢ºèª
docker exec -it <container_id> /bin/bash
```

### 2. æ‹¡å¼µæ©Ÿèƒ½ãŒå‹•ä½œã—ãªã„

```json
{
  "customizations": {
    "vscode": {
      "extensions": [
        // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®š
        "ms-python.python@2023.20.0"
      ]
    }
  }
}
```

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒé…ã„

```json
{
  // macOSã§ã®æœ€é©åŒ–
  "mounts": [
    "source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=delegated"
  ],
  // å¤§ããªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’é™¤å¤–
  "postCreateCommand": "echo 'node_modules' >> .dockerignore"
}
```

# å®Ÿè·µä¾‹ï¼šãƒãƒ«ãƒè¨€èªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReactï¼‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆPythonï¼‰ã‚’å«ã‚€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾‹:

```json
{
  "name": "Full Stack Project",
  "build": {
    "dockerfile": "Dockerfile",
    "args": {
      "NODE_VERSION": "18",
      "PYTHON_VERSION": "3.11"
    }
  },
  "features": {
    "ghcr.io/devcontainers/features/node:1": {},
    "ghcr.io/devcontainers/features/python:1": {}
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "dbaeumer.vscode-eslint",
        "ms-python.python",
        "ms-python.vscode-pylance",
        "esbenp.prettier-vscode"
      ],
      "settings": {
        "python.defaultInterpreterPath": "/usr/local/bin/python",
        "python.linting.enabled": true,
        "python.linting.pylintEnabled": true,
        "editor.formatOnSave": true,
        "[javascript]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        },
        "[python]": {
          "editor.defaultFormatter": "ms-python.python"
        }
      }
    }
  },
  "forwardPorts": [3000, 8000],
  "postCreateCommand": "npm install && pip install -r requirements.txt"
}
```

# ä¸Šç´šè€…å‘ã‘Tips

## 1. ã‚«ã‚¹ã‚¿ãƒ Featureã®ä½œæˆ

ç‹¬è‡ªã®Featureã‚’ä½œæˆã—ã¦ã€ãƒãƒ¼ãƒ å†…ã§å…±æœ‰ã§ãã¾ã™ã€‚

```json
{
  "features": {
    "./local-features/my-feature": {}
  }
}
```

## 2. CI/CDã¨ã®çµ±åˆ

```yaml
# GitHub Actionsä¾‹
name: Test in devcontainer

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: devcontainers/ci@v0.3
        with:
          runCmd: npm test
```

## 3. ãƒ—ãƒªãƒ“ãƒ«ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸

```yaml
# .github/workflows/build-devcontainer.yml
name: Build devcontainer

on:
  push:
    paths:
      - '.devcontainer/**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build and push
        uses: devcontainers/ci@v0.3
        with:
          imageName: ghcr.io/${{ github.repository }}/devcontainer
          push: always
```

# ã¾ã¨ã‚

devcontainerã¯ã€é–‹ç™ºç’°å¢ƒã®æ¨™æº–åŒ–ã¨å…±æœ‰ã‚’åŠ‡çš„ã«ç°¡å˜ã«ã™ã‚‹å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

**åˆå¿ƒè€…ã®æ–¹ã¸**: ã¾ãšã¯åŸºæœ¬çš„ãªè¨­å®šã‹ã‚‰å§‹ã‚ã¦ã€å¾ã€…ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

**ä¸Šç´šè€…ã®æ–¹ã¸**: Docker Composeé€£æºã€ã‚«ã‚¹ã‚¿ãƒ Featureã€CI/CDçµ±åˆãªã©ã€ã‚ˆã‚Šé«˜åº¦ãªæ©Ÿèƒ½ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒãƒ¼ãƒ å…¨ä½“ã®ç”Ÿç”£æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«devcontainerã‚’è¿½åŠ ã—ã¦ã¿ã‚‹
2. ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨ç’°å¢ƒã‚’å…±æœ‰ã™ã‚‹
3. CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ„ã¿è¾¼ã‚€
4. ã‚«ã‚¹ã‚¿ãƒ Featureã‚’ä½œæˆã—ã¦å†åˆ©ç”¨æ€§ã‚’é«˜ã‚ã‚‹

é–‹ç™ºç’°å¢ƒã®æ§‹ç¯‰ã«æ‚©ã‚€æ™‚é–“ã‚’æ¸›ã‚‰ã—ã€æœ¬æ¥ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã«é›†ä¸­ã§ãã‚‹ç’°å¢ƒã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ã‚‡ã†ï¼

## å‚è€ƒãƒªãƒ³ã‚¯

- [Dev Containerså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://containers.dev/)
- [VSCode Dev Containers](https://code.visualstudio.com/docs/devcontainers/containers)
- [åˆ©ç”¨å¯èƒ½ãªFeaturesä¸€è¦§](https://github.com/devcontainers/features)

Happy Coding with devcontainers! ğŸš€
