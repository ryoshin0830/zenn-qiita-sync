---
title: devcontainerã‚’ä½¿ã†ä¸Šã§è©°ã¾ã‚‹ãƒã‚¤ãƒ³ãƒˆé›†ã¨ãã®è§£æ±ºæ–¹æ³•
emoji: "\U0001F433"
type: tech
topics:
  - Docker
  - VSCode
  - devcontainer
  - é–‹ç™ºç’°å¢ƒ
  - ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
published: true
---
# ã¯ã˜ã‚ã«

devcontainerã‚’ä½¿ã£ã¦ã„ã¦ã€Œãªã‚“ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã‚“ã ...ã€ã¨é ­ã‚’æŠ±ãˆãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ

ç§ã‚‚æœ€åˆã¯è¨­å®šãƒŸã‚¹ã‚„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œã«æ‚©ã¾ã•ã‚Œã¾ã—ãŸã€‚ãã“ã§ã€devcontainerã‚’å°å…¥ã™ã‚‹éš›ã«ã‚ˆãé­é‡ã™ã‚‹å•é¡Œã¨ãã®è§£æ±ºæ–¹æ³•ã‚’ã€å®Ÿéš›ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨å…±ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€åˆæœŸè¨­å®šã®ã‚¨ãƒ©ãƒ¼ã‹ã‚‰ç’°å¢ƒä¾å­˜ã®å•é¡Œã¾ã§ã€7ã¤ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«åˆ†ã‘ã¦å®Ÿè·µçš„ãªè§£æ±ºç­–ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## 1. åˆæœŸè¨­å®šæ™‚ã®å…¸å‹çš„ãªã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ³•

### ğŸ”¥ Dockerãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒèµ·å‹•ã—ã¦ã„ãªã„

æœ€ã‚‚é »ç¹ã«é­é‡ã™ã‚‹ã‚¨ãƒ©ãƒ¼ãŒã“ã‚Œã§ã™ï¼š

```
Failed to connect. Is Docker installed and running?
```

**è§£æ±ºæ–¹æ³•ï¼š**

```bash
# Linux/macOSã®å ´åˆ
sudo systemctl start docker
sudo usermod -aG docker $USER
newgrp docker

# æ¨©é™ä¿®æ­£ã‚‚å¿˜ã‚Œãšã«
sudo chown "$USER":"$USER" /home/"$USER"/.docker -R
sudo chmod g+rwx "$HOME/.docker" -R
```

### ğŸ”¥ VS Codeæ‹¡å¼µæ©Ÿèƒ½ãŒå‹•ã‹ãªã„

Alpine Linuxãƒ™ãƒ¼ã‚¹ã®ã‚³ãƒ³ãƒ†ãƒŠã§ã¯ã€glibcã«ä¾å­˜ã™ã‚‹æ‹¡å¼µæ©Ÿèƒ½ãŒå‹•ä½œã—ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

**è§£æ±ºæ–¹æ³•ï¼š**

```dockerfile
FROM alpine:latest
# glibcã‚’è¿½åŠ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apk add --no-cache \
    libc6-compat \
    libstdc++
```

### ğŸ”¥ devcontainer.jsonã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼

VS Code 1.86ä»¥é™ã§ã¯ã€`extensions`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ›¸ãæ–¹ãŒå¤‰ã‚ã‚Šã¾ã—ãŸï¼

**âŒ å¤ã„æ›¸ãæ–¹ï¼š**
```json
{
  "extensions": ["ms-vscode.vscode-typescript-next"]
}
```

**âœ… æ–°ã—ã„æ›¸ãæ–¹ï¼š**
```json
{
  "customizations": {
    "vscode": {
      "extensions": ["ms-vscode.vscode-typescript-next"]
    }
  }
}
```

## 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è½ã¨ã—ç©´ã‚’å›é¿ã™ã‚‹æ–¹æ³•

### ğŸš€ node_modulesã®é…ã•ã‚’è§£æ±º

node_modulesã®ã‚ˆã†ãªå¤§é‡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€åå‰ä»˜ããƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§åŠ‡çš„ã«é«˜é€ŸåŒ–ã§ãã¾ã™ï¼š

```json
{
  "mounts": [
    "source=${localWorkspaceFolderBasename}-node_modules,target=${containerWorkspaceFolder}/node_modules,type=volume"
  ],
  "postCreateCommand": "sudo chown node node_modules"
}
```

ã“ã‚Œã§**50-80%ã®é€Ÿåº¦æ”¹å–„**ãŒæœŸå¾…ã§ãã¾ã™ï¼

### ğŸš€ docker-compose.ymlã®ç½ 

ã‚µãƒ¼ãƒ“ã‚¹åã«ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã¯ä½¿ãˆã¾ã›ã‚“ï¼š

```yaml
version: '3'
services:
  # âŒ service_a ã§ã¯ãªã
  # âœ… servicea ã‚’ä½¿ç”¨
  servicea:
    image: node:18
  serviceb:
    image: postgres:13
```

### ğŸš€ Dockerfileã®æœ€é©åŒ–

ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºã‚’å‰Šæ¸›ã™ã‚‹ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ï¼š

```dockerfile
# è¤‡æ•°ã®RUNã‚³ãƒãƒ³ãƒ‰ã‚’1ã¤ã«ã¾ã¨ã‚ã‚‹
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    git \
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
    && rm -rf /var/lib/apt/lists/*
```

## 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œã®è¨ºæ–­ã¨æ”¹å–„ç­–

### âš¡ ãƒ“ãƒ«ãƒ‰æ™‚é–“ã‚’60-80%çŸ­ç¸®

BuildKitã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¦ãƒ³ãƒˆæ©Ÿèƒ½ã‚’æ´»ç”¨ï¼š

```dockerfile
# pipã®ä¾‹
RUN --mount=type=cache,target=/root/.cache/pip \
    pip install -r requirements.txt

# npmã®ä¾‹  
RUN --mount=type=cache,target=/root/.npm \
    npm ci --cache /root/.npm
```

### âš¡ èµ·å‹•æ™‚é–“ã®æœ€é©åŒ–

è»½é‡ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€80-85%ã®ã‚µã‚¤ã‚ºå‰Šæ¸›ãŒå¯èƒ½ï¼š

```dockerfile
# âŒ node:18 (993MB)
# âœ… node:18-alpine (169MB)
FROM node:18-alpine
```

### âš¡ ãƒ¡ãƒ¢ãƒªã¨CPUã®æœ€é©åŒ–

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ã¯ä¸ååˆ†ãªå ´åˆãŒå¤šã„ã§ã™ï¼š

```json
{
  "runArgs": [
    "--memory=4g",
    "--cpus=2.0"
  ],
  "hostRequirements": {
    "memory": "4gb",
    "cpus": 2
  }
}
```

## 4. ç’°å¢ƒä¾å­˜å•é¡Œã¸ã®å¯¾å‡¦æ³•

### ğŸ–¥ï¸ Windows (WSL2) ã®å•é¡Œ

ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´é€šçŸ¥ãŒæ©Ÿèƒ½ã—ãªã„å ´åˆï¼š

```json
{
  "remoteEnv": {
    "CHOKIDAR_USEPOLLING": "true"
  },
  "settings": {
    "files.eol": "\n",
    "git.autocrlf": "input"
  }
}
```

### ğŸ Mac (Apple Silicon) ã®å¯¾å¿œ

AMD64ã‚³ãƒ³ãƒ†ãƒŠã‚’å‹•ã‹ã™å ´åˆï¼š

```json
{
  "build": {
    "dockerfile": "Dockerfile",
    "options": ["--platform=linux/amd64"]
  },
  "runArgs": ["--platform=linux/amd64"]
}
```

ãŸã ã—ã€å¯èƒ½ãªé™ã‚ŠARM64ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹ã¨**5-10å€ã®æ€§èƒ½å‘ä¸Š**ãŒæœŸå¾…ã§ãã¾ã™ã€‚

### ğŸ§ Linux (SELinux) ã®å•é¡Œ

Permission deniedã‚¨ãƒ©ãƒ¼ã®è§£æ±ºï¼š

```json
{
  "mounts": [
    "source=/host/path,target=/container/path,type=bind,consistency=cached,z"
  ]
}
```

## 5. é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®çµ±åˆã¨è‡ªå‹•åŒ–

### ğŸ” Git/SSHè¨­å®šã®è‡ªå‹•å¼•ãç¶™ã

```json
{
  "mounts": [
    "source=${localEnv:HOME}${localEnv:USERPROFILE}/.ssh,target=/home/vscode/.ssh,type=bind,consistency=cached"
  ],
  "postStartCommand": "git config --global --add safe.directory ${containerWorkspaceFolder}"
}
```

### ğŸ” ç’°å¢ƒå¤‰æ•°ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†

```json
{
  "containerEnv": {
    "ENVIRONMENT": "development"
  },
  "remoteEnv": {
    "API_KEY": "${localEnv:API_KEY}",
    "DATABASE_URL": "${localEnv:DATABASE_URL}"
  }
}
```

**ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆï¼š** `.env-sample`ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«å«ã‚ã€å®Ÿéš›ã®å€¤ã¯`.env`ã§ç®¡ç†ã—ã¾ã™ã€‚

## 6. 2024å¹´ã®æœ€æ–°å•é¡Œã¨è§£æ±ºäº‹ä¾‹

### ğŸ†• VS Code 1.86ä»¥é™ã®äº’æ›æ€§å•é¡Œ

ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆï¼š

```
bad option: --ms-enable-electron-run-as-node
```

**è§£æ±ºæ–¹æ³•ï¼š**
- Dev Containersæ‹¡å¼µæ©Ÿèƒ½ã®ãƒ—ãƒ¬ãƒªãƒªãƒ¼ã‚¹ç‰ˆã‚’ä½¿ç”¨
- VS Code 1.88ä»¥é™ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

### ğŸ†• Docker BuildKitã®ã‚¨ãƒ©ãƒ¼

```
invalid character '\x00' looking for beginning of value
```

**è§£æ±ºæ–¹æ³•ï¼š**
```bash
# BuildKitã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–
export DOCKER_BUILDKIT=0
```

## 7. é–‹ç™ºåŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### âœ¨ æ¨å¥¨è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```json
{
  "name": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå é–‹ç™ºç’°å¢ƒ",
  "image": "mcr.microsoft.com/devcontainers/javascript-node:18",
  "remoteUser": "node",
  
  // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  "mounts": [
    "source=${localWorkspaceFolderBasename}-node_modules,target=${containerWorkspaceFolder}/node_modules,type=volume"
  ],
  
  // ä¾¿åˆ©ãªè¨­å®š
  "features": {
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/github-cli:1": {}
  },
  
  // ãƒãƒ¼ãƒˆè¨­å®š
  "portsAttributes": {
    "3000": {
      "label": "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³",
      "onAutoForward": "notify"
    }
  },
  
  // åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  "postCreateCommand": "npm install"
}
```

### âœ¨ ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„

å•é¡ŒãŒç™ºç”Ÿã—ãŸã‚‰ã€ã¾ãšãƒ­ã‚°ã‚’ç¢ºèªï¼š

1. `Ctrl+Shift+P` (Mac: `Cmd+Shift+P`)
2. `Dev Containers: Show Container Log`ã‚’é¸æŠ
3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

### âœ¨ CI/CDçµ±åˆ

GitHub Actionsã§ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆï¼š

```yaml
name: Dev Container CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Dev Container ã§ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆ
        uses: devcontainers/ci@v0.3
        with:
          runCmd: |
            npm ci
            npm test
```

## ã¾ã¨ã‚

devcontainerã®å°å…¥ã§è©°ã¾ã‚‹ãƒã‚¤ãƒ³ãƒˆã¯å¤šã„ã§ã™ãŒã€é©åˆ‡ãªè¨­å®šã¨ç†è§£ã«ã‚ˆã‚Šå›é¿å¯èƒ½ã§ã™ã€‚

é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š
- ğŸ¯ ç’°å¢ƒä¾å­˜ã®å•é¡Œã‚’ç†è§£ã—ã€ãƒãƒ¼ãƒ å†…ã§æ¨™æº–åŒ–ã•ã‚ŒãŸè¨­å®šã‚’å…±æœ‰
- ğŸ¯ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆåå‰ä»˜ããƒœãƒªãƒ¥ãƒ¼ãƒ ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨ï¼‰ã§50-80%æ”¹å–„
- ğŸ¯ æœ€æ–°ã®VS Codeã¨ã®äº’æ›æ€§ã«æ³¨æ„

ã“ã®è¨˜äº‹ãŒã€devcontainerã§ã®é–‹ç™ºã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«é€²ã‚ã‚‹åŠ©ã‘ã«ãªã‚Œã°å¹¸ã„ã§ã™ï¼

## å‚è€ƒãƒªãƒ³ã‚¯

- [VS Code Dev Containerså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://code.visualstudio.com/docs/devcontainers/containers)
- [Dev Containerä»•æ§˜](https://containers.dev/)
- [Dockerå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.docker.com/)

---

**è³ªå•ã‚„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã‚ã‚Œã°ã€ãœã²ã‚³ãƒ¡ãƒ³ãƒˆã§ãŠçŸ¥ã‚‰ã›ãã ã•ã„ï¼**
